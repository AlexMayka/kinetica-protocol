# Kinetica Protocol Specification

## Protocol Structure

### Packet Format

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Kinetica Packet                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Header  â”‚  PacketID  â”‚ MsgType  â”‚  Len   â”‚ Payload  â”‚  Footer  â”‚
â”‚    2B    â”‚     1B     â”‚    1B    â”‚   1B   â”‚   0-XB   â”‚   1-4B   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Header Structure (6 bytes total)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Magic Bytes â”‚  PacketID  â”‚ MsgType  â”‚  Len   â”‚
â”‚  "KN" (2B)  â”‚     1B     â”‚    1B    â”‚   1B   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Footer Structure (Variable size based on CRC type)

```
Transport CRC Types:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TransportNone    â”‚   0B     â”‚ No footer   â”‚
â”‚ TransportLength  â”‚   1B     â”‚ Length only â”‚  
â”‚ TransportCRC8    â”‚   1B     â”‚ CRC8        â”‚
â”‚ TransportCRC16   â”‚   2B     â”‚ CRC16       â”‚
â”‚ TransportCRC32   â”‚   4B     â”‚ CRC32       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Message Types and Sizes

### Core Messages

| Message Type | ID | Min Size | Typical Size | Max Size | Description |
|--------------|----|---------:|-------------:|---------:|-------------|
| SensorCommand | 0x01 | 11B | 11B | 11B | Command to sensor |
| SensorConfig | 0x02 | 12B | 20B | ~1KB | Sensor configuration |
| SensorHeartbeat | 0x03 | 13B | 13B | 13B | Heartbeat with battery |
| SensorData | 0x04 | 25B | 25B | 25B | Single axis data |
| CustomData | 0x05 | 12B | 50B | ~64KB | Custom payload |
| TimeSync | 0x06 | 15B | 15B | 15B | Time synchronization |
| Ack | 0x07 | 10B | 10B | 10B | Acknowledgment |
| Registration | 0x08 | 11B | 11B | 11B | Sensor registration |
| Fragment | 0x09 | 12B | 512B | ~64KB | Message fragmentation |

### Extended Messages

| Message Type | ID | Min Size | Typical Size | Max Size | Description |
|--------------|----|---------:|-------------:|---------:|-------------|
| RelayedMessage | 0x0A | 10B | 34B | ~64KB | Relayed through ESP-NOW |
| SensorDataMulti | 0x0B | 15B | 77B | 77B | Multiple sensor data (planned) |

## Device Types

```
Classification by Sensor Axes:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Device Type     â”‚  ID  â”‚ Description                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DeviceType3Axis â”‚ 0x01 â”‚ 3-axis (Accelerometer only)    â”‚
â”‚ DeviceType6Axis â”‚ 0x02 â”‚ 6-axis (Accel + Gyroscope)     â”‚
â”‚ DeviceType9Axis â”‚ 0x03 â”‚ 9-axis (Accel + Gyro + Mag)    â”‚
â”‚ DeviceTypeHub   â”‚ 0x10 â”‚ Data concentrator/hub           â”‚
â”‚ DeviceTypeRelay â”‚ 0x11 â”‚ ESP-NOW relay/retransmitter     â”‚
â”‚ DeviceTypeCustomâ”‚ 0xFF â”‚ Custom/user-defined types       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Capabilities Flags

```
Sensor Capabilities (Bitfield):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Capability       â”‚ Bit Pos â”‚ Description                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CapAccelerometer â”‚    0    â”‚ Has accelerometer (0x01)     â”‚
â”‚ CapGyroscope     â”‚    1    â”‚ Has gyroscope (0x02)         â”‚
â”‚ CapMagnetometer  â”‚    2    â”‚ Has magnetometer (0x04)      â”‚
â”‚ CapQuaternion    â”‚    3    â”‚ Can output quaternions (0x08)â”‚
â”‚ CapTemperature   â”‚    4    â”‚ Has temperature sensor (0x10)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Transport Support Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Transport   â”‚ TCP â”‚ UDP â”‚ SERIAL  â”‚  BLE   â”‚ ESP-NOW â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Status      â”‚  âœ…  â”‚ ğŸ”„  â”‚   ğŸ”„    â”‚   ğŸ”„   â”‚   ğŸ”„    â”‚
â”‚ Max Packet  â”‚ 64K â”‚ 64K â”‚  Unlimited â”‚ ~240B  â”‚  250B   â”‚
â”‚ Reliability â”‚ Highâ”‚ Low â”‚   High  â”‚  High  â”‚   Low   â”‚
â”‚ Use Case    â”‚Demo â”‚Fast â”‚ESP-NOW  â”‚Config  â”‚ Mesh    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Legend: âœ… Implemented, ğŸ”„ Planned
```

## Packet Size Examples

### Minimum Packets (with TransportNone)
```
Registration:     [KN][01][08][05][sensor_data]           = 11 bytes
Ack:             [KN][01][07][04][ack_data]               = 10 bytes  
Heartbeat:       [KN][01][03][07][heartbeat_data]         = 13 bytes
SensorData:      [KN][01][04][13][sensor_data]            = 25 bytes
```

### Maximum Practical Packets
```
SensorConfig:    [KN][01][02][~1000][config_items][CRC32] = ~1KB
CustomData:      [KN][01][05][~64K][custom_payload][CRC32] = ~64KB  
Fragment:        [KN][01][09][~64K][fragment_data][CRC32]  = ~64KB
RelayedMessage:  [KN][01][0A][32][relay_id + orig_packet] = varies
```

### Transport Overhead
```
TransportNone:    +0 bytes (no footer)
TransportLength:  +1 byte  (length check)
TransportCRC8:    +1 byte  (basic CRC)
TransportCRC16:   +2 bytes (standard CRC)
TransportCRC32:   +4 bytes (robust CRC)
```

## System Architecture

### Transport Layer Overview
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Application Layer                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       Kinetica Protocol                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TCP Transportâ”‚ UDP Transportâ”‚ BLE Transportâ”‚Serial Transportâ”‚ ... â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    TCP/IP   â”‚   UDP/IP    â”‚  Bluetooth  â”‚    UART     â”‚   ...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Flow Architecture
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Sensor    â”‚â”€â”€â”€â–¶â”‚    ESP32    â”‚â”€â”€â”€â–¶â”‚   Gateway   â”‚â”€â”€â”€â–¶â”‚   Server    â”‚
â”‚  (BNO085)   â”‚    â”‚  (ESP-NOW)  â”‚    â”‚  (Serial)   â”‚    â”‚   (TCP)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                    â”‚                    â”‚                    â”‚
    BLE Config        ESP-NOW Mesh         Serial Link         Network
   (25-100B/msg)      (25-32B/msg)        (32B relayed)      (Aggregated)
```

## Communication Flows

### Sensor Registration Flow
```
Sensor                           Server
  â”‚                                â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€ Registration â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ (11B)
  â”‚        [SensorID, Type,       â”‚
  â”‚         Capabilities]         â”‚
  â”‚                               â”‚
  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ack â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ (10B)
  â”‚          [Status: OK]         â”‚
  â”‚                               â”‚
  â”‚â”€â”€ Ready for data exchange â”€â”€â”€â”‚
```

### Data Transmission Flow  
```
Sensor                           Server
  â”‚                                â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€ SensorData â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ (25B)
  â”‚       [Accel X,Y,Z values]    â”‚
  â”‚                               â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€ Heartbeat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ (13B)
  â”‚       [Battery: 85%]          â”‚
  â”‚                               â”‚
  â”‚â—€â”€â”€â”€â”€â”€â”€ TimeSync â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ (15B)
  â”‚      [Server timestamp]       â”‚
```

### ESP-NOW Relay Flow
```
Sensor â”€â”€â”€â–¶ ESP32 Relay â”€â”€â”€â–¶ Gateway â”€â”€â”€â–¶ Server
   â”‚            â”‚               â”‚            â”‚
   â”‚    25B     â”‚     32B       â”‚    32B     â”‚   Processed
   â”‚            â”‚               â”‚            â”‚
   â”‚  Original  â”‚   Relayed     â”‚  Relayed   â”‚   Data
   â”‚  Packet    â”‚   Packet      â”‚  Packet    â”‚
   â”‚            â”‚               â”‚            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Data]  â”‚ â”‚[RelayID][Data]  â”‚ â”‚[Relayed] â”‚ â”‚Extract & â”‚
â”‚         â”‚ â”‚                 â”‚ â”‚Message   â”‚ â”‚Process   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Multi-Transport Configuration
```
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚   Server    â”‚
                           â”‚  (TCP/UDP)  â”‚
                           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                            â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                            â”‚  Gateway  â”‚
                            â”‚ (Serial)  â”‚
                            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                  â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚    ESP32 Relay       â”‚
                      â”‚    (ESP-NOW Hub)     â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                     â”‚                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Sensor 1    â”‚     â”‚   Sensor 2    â”‚     â”‚   Sensor 3    â”‚
    â”‚ (BLE Config)  â”‚     â”‚ (BLE Config)  â”‚     â”‚ (BLE Config)  â”‚
    â”‚ (ESP-NOW Data)â”‚     â”‚ (ESP-NOW Data)â”‚     â”‚ (ESP-NOW Data)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Message Size Progression
```
Original Sensor Data:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [KN][01][04][13][SensorData] = 25B  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After ESP-NOW Relay:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  
â”‚ [KN][02][0A][1A][RelayID][Original_25B_Packet] = 32B    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After Multi-Axis Aggregation:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [KN][03][0B][47][DataMask][Accel][Gyro][Mag][Quat][Euler] = 77B    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Usage Patterns

### BLE Configuration Sequence
```
Mobile App                     Sensor (BLE Peripheral)
    â”‚                               â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€ Scan & Connect â”€â”€â”€â”€â”€â”€â–¶â”‚
    â”‚                               â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€ Read Capabilities â”€â”€â”€â–¶â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€ [9-Axis, BNO085] â”€â”€â”€â”€â”€â”‚
    â”‚                               â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€ SensorConfig â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ (Sample rate, range, etc.)
    â”‚â—€â”€â”€â”€â”€â”€â”€ Ack [OK] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                               â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€ Disconnect â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ (Switch to ESP-NOW mesh)
```

### ESP-NOW Mesh Operation
```
Time: 0ms     100ms    200ms    300ms    400ms
  â”‚           â”‚        â”‚        â”‚        â”‚
Sensor1 â”€â”€â”€â”€â”€â–¶Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶HB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶Data
Sensor2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶HB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶Data  
Sensor3 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶HB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
  â”‚           â”‚        â”‚        â”‚        â”‚
Relay   â”€â”€â”€â”€â”€â–¶Fwd â”€â”€â”€â”€â–¶Fwd â”€â”€â”€â”€â–¶Fwd â”€â”€â”€â”€â–¶Fwd
  â”‚           â”‚        â”‚        â”‚        â”‚
Gateway â”€â”€â”€â”€â”€â–¶Recvâ”€â”€â”€â”€â–¶Recvâ”€â”€â”€â”€â–¶Recvâ”€â”€â”€â”€â–¶Recv
  â”‚           â”‚        â”‚        â”‚        â”‚
Server  â”€â”€â”€â”€â”€â–¶Procâ”€â”€â”€â”€â–¶Procâ”€â”€â”€â”€â–¶Procâ”€â”€â”€â”€â–¶Proc

Legend: Data=SensorData(25B), HB=Heartbeat(13B), Fwd=RelayedMessage(32B)
```